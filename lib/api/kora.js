const fetch =  require('node-fetch');
const cheerio = require('cheerio');
const moment =  require('moment');

const leagueEmojis = [
  { league: 'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ', emoji: 'ðŸ‡«ðŸ‡·' }, 
  { league: 'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²', emoji: 'ðŸ´' }
];

const excludedLeagues = [
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù„ÙŠØ¨ÙŠØ±ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ØµÙŠÙ†ÙŠ Ø³ÙˆØ¨Ø±',
  'Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø±Ø¯ÙŠÙ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ',
  'Ø¨Ø·ÙˆÙ„Ø© Ø¨Ø§ÙˆÙ„ÙŠØ³ØªØ§ Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù‚Ø·Ø±ÙŠ Ù†Ø¬ÙˆÙ… Ù‚Ø·Ø±',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø±ÙˆØ³ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙƒÙˆØ±ÙŠ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠ',
  'ÙƒØ£Ø³ Ø¥ÙŠØ±Ø§Ù† Ø­Ø°ÙÙŠ',
  'ÙƒØ£Ø³ Ø§Ù„Ø±Ø§Ø¨Ø·Ø© Ø§Ù„Ù…ØµØ±ÙŠØ©',
  'ÙƒØ£Ø³ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±',
  'ÙƒØ£Ø³ Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙƒÙˆÙŠØªÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ Ù†Ø¬ÙˆÙ…',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ù„Ù„Ø³ÙŠØ¯Ø§Øª Ø³ÙˆØ¨Ø±',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ø³Ø¨Ø§Ù†ÙŠ Ù„Ù„Ø³ÙŠØ¯Ø§Øª',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ù…Ø§Ø±Ø§ØªÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ø³Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ù†ÙŠ Ù„Ù„Ù…Ø­ØªØ±ÙÙŠÙ†',
  'ØªØ´Ø§Ù…Ø¨ÙŠÙˆÙ†Ø´ÙŠØ¨ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ù„Ù„Ø³ÙŠØ¯Ø§Øª Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ù„Ù„Ù†Ø§Ø´Ø¦ÙŠÙ† ØªØ­Øª 17 Ø³Ù†Ø©',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ØªÙˆÙ†Ø³ÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·Ø© Ø§Ù„Ù…Ø­ØªØ±ÙØ© Ø§Ù„Ø£ÙˆÙ„Ù‰',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù†Ø±ÙˆÙŠØ¬ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù…Ø§Ù„ÙŠØ²ÙŠ Ø§Ù„Ø³ÙˆØ¨Ø±',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£Ø±Ø¬Ù†ØªÙŠÙ†ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù†Ù…Ø³Ø§ÙˆÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¨ÙˆÙ„Ù†Ø¯ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ØªØ´ÙŠÙƒÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£ÙˆÙƒØ±Ø§Ù†ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¨Ø±ØªØºØ§Ù„ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ØµØ±Ø¨ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'ÙƒØ£Ø³ QSL Ø§Ù„Ù‚Ø·Ø±ÙŠØ© Ooredoo',
  'ÙƒØ£Ø³ Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¥Ù…Ø§Ø±Ø§ØªÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù…Ø¬Ø±ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ØªÙˆÙ†Ø³ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·Ø© Ø§Ù„Ù…Ø­ØªØ±ÙØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙƒØ±ÙˆØ§ØªÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥ÙŠØ·Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© B',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ù„Ù„Ø´Ø¨Ø§Ø¨ ØªØ­Øª 19 Ø³Ù†Ø©',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£Ø³ØªØ±Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© A',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù…ÙƒØ³ÙŠÙƒÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø³ÙˆÙŠØ¯ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù‡ÙˆÙ„Ù†Ø¯ÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙŠÙˆÙ†Ø§Ù†ÙŠ Ø§Ù„Ø³ÙˆØ¨Ø±',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¯Ù†Ù…Ø§Ø±ÙƒÙŠ Ø§Ù„Ø³ÙˆØ¨Ø±',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø³ÙˆÙŠØ³Ø±ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ø³ÙƒØªÙ„Ù†Ø¯ÙŠ Ù„Ù„Ù…Ø­ØªØ±ÙÙŠÙ†',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø£)',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø§Ø³Ø¨Ø§Ù†ÙŠ - Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©',
  'Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù…Ø­ØªØ±ÙÙŠÙ† Ø§Ù„Ø¥Ù…Ø§Ø±Ø§ØªÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù„Ø¨Ù†Ø§Ù†ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙˆØ¯ÙŠØ© -  Ø£Ù†Ø¯ÙŠØ©',
  'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ† - ÙƒØ§Ø³ Ø§Ù„Ù…Ù„Ùƒ',
  'ÙƒØ£Ø³ Ø§Ù„Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø¢Ø³ÙŠÙˆÙŠ Ù„Ù„Ø£Ù†Ø¯ÙŠØ©',
  'Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¢Ø³ÙŠÙˆÙŠØ© - ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„ÙŠ',
  'Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© 2 Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ',
  'Ø¯ÙˆØ±ÙŠ Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ù„Ù…Ø§Ù† Ø¯. Ø£ÙˆÙ„Ù‰',
  'Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø´Ø¨Ø§Ø¨ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ',
  'Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ ÙŠÙ„Ùˆ',
  'Ø¯ÙˆØ±ÙŠ Ø¬Ù†ÙˆØ¨ Ø£ÙØ±ÙŠÙ‚ÙŠØ§',
  'Ø¯ÙˆØ±ÙŠ Ø£Ø¨Ø·Ø§Ù„ Ø£ÙˆØ±ÙˆØ¨Ø§ Ù„Ù„Ø´Ø¨Ø§Ø¨',
  'Ù„ÙŠØ³ÙˆØªÙˆ - Ø¯ÙˆØ±ÙŠ Ù„ÙŠØ³ÙˆØªÙˆ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø§Ù„ÙƒÙˆÙŠØªÙŠ',
  'Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø§Ù„ØªÙˆÙ†Ø³ÙŠ',
  'Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ',
  'Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø§Ù„Ù‚Ø·Ø±ÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙŠÙ…Ù†ÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù„ÙŠØ¨ÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø³ÙˆØ±ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²',
  'Ø¯ÙˆØ±ÙŠ Ù†Ø¬ÙˆÙ… Ù‚Ø·Ø±',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ',
  'ÙƒØ£Ø³ Ø®Ø§Ø¯Ù… Ø§Ù„Ø­Ø±Ù…ÙŠÙ† Ø§Ù„Ø´Ø±ÙŠÙÙŠÙ†',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ù…Ø§Ø±Ø§ØªÙŠ Ù„Ù„Ù…Ø­ØªØ±ÙÙŠÙ†',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¹Ù…Ø§Ù†ÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙƒÙˆÙŠØªÙŠ', 'ÙƒØ£Ø³ ØªØ±ÙƒÙŠØ§',
  'ÙƒØ£Ø³ Ø§Ù„Ø£Ø±Ø¯Ù†',
  'ÙˆØ¯ÙŠØ§Øª Ø£Ù†Ø¯ÙŠØ© (3)',
  'ÙƒØ£Ø³ Ù…ØµØ±',
  'ÙƒØ£Ø³ Ø§Ù„ÙŠÙˆÙ†Ø§Ù†',
  'ÙƒØ£Ø³ Ø§Ù„Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ø¹Ù…Ø§Ù†ÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ØªÙˆÙ†Ø³ÙŠ',
  'ÙƒØ£Ø³ Ø±Ø§Ø¨Ø·Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø§Ø±Ø¬Ù†ØªÙŠÙ†ÙŠ',
  'ÙƒØ£Ø³ ÙˆÙ„ÙŠ Ø§Ù„Ø¹Ù‡Ø¯ Ø§Ù„ÙƒÙˆÙŠØªÙŠ',
  'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠ Ù„Ù„Ù…Ø­ØªØ±ÙÙŠÙ†',
];

const getLeagueEmoji = (leagueName) => {
  const match = leagueEmojis.find(item => item.league === leagueName);
  return match ? match.emoji : 'â€';
};

const kora = async () => {
  const url = 'https://jdwel.com/today/';

  try {
    const response = await fetch(url);
    const html = await response.text();
    const $ = cheerio.load(html);

        const matches = [];

        $('ul.comp_matches_list.matches_list').each((_, element) => {

          const leagueName = $(element).find('.comp_separator.container .main h4').text().trim();

          if (excludedLeagues.includes(leagueName)) return;

          const leagueEmoji = getLeagueEmoji(leagueName);

          // Ø¥Ø¶Ø§ÙØ© ÙƒØ§Ø¦Ù† Ø§Ù„Ø¯ÙˆØ±ÙŠ Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª
          matches.push({
            league: leagueName, 
            emoji: leagueEmoji,
            matches: [] // Ø¥Ø¶Ø§ÙØ© Ù…ØµÙÙˆÙØ© ÙØ§Ø±ØºØ© Ù„Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª
          });

          $(element).find('.single_match').each((_, match) => {
        // Extract match data
        const teamNames = [
          $(match).find('.team.hometeam span.the_team').text().trim(),
          $(match).find('.team.awayteam span.the_team').text().trim()
        ];

        const dateTime = $(match).find('.middle_column.cell.col-2 .match_time .the_otime').text();
        const time = moment(dateTime).subtract(2, 'hours').format('HH:mm');

        const status = $(match).find('.match_status span').text().trim();

        const score = [
          $(match).find('.match_score .hometeam').text(),
          $(match).find('.match_score .awayteam').text()
        ];

        // Add match to list
            matches[matches.length-1].matches.push({
              teamNames,
              time,
              status,
              score
            });
      });
    });
    const json = JSON.stringify(matches);

   return json;

  } catch (error) {
    console.error('Error fetching matches:', error);
    return null;
  }
};
module.exports = kora;
